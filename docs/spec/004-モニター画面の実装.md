# 004 - モニター画面の実装

## 概要
会場に設置されたモニターに映すための専用表示ページ。
管理者画面から新しいウィンドウでアクセスでき、ユーザー画面と同じUIで画面遷移がリアルタイムに同期される。
回答機能はなく、出題や進行結果の表示のみが可能。

---

## ユーザーストーリー

### US-004-01: モニター画面の基本実装
**As an** admin
**I want to** 管理画面からモニター用ページを新しいウィンドウで開く
**So that** 会場に設置されたモニターに同じ内容を映すことができる

#### 受け入れ基準

##### 1. 管理画面の画面制御への導線追加
- [x] admin画面の画面制御ページに「モニター画面を開く」ボタンを追加
- [x] ボタンをクリックすると新しいウィンドウでモニター画面ページが開く
- [x] モニター画面のURLパターン: `/monitor/[eventId]`
- [x] URLから `eventId` を取得してモニター画面を表示する

##### 2. リアルタイム同期機能
- [x] `quiz_control` テーブルをSupabase Realtimeで監視
- [x] `current_screen` が変更されると画面が自動的に遷移
- [x] ユーザー画面と同じタイミングで画面が切り替わる
- [x] セッション機能は不要（セッション情報を持たない）

##### 3. 機能制限
- [x] ユーザー登録機能は不要
- [x] セッション機能は不要
- [x] ユーザー固有情報（ニックネーム、スコア）は表示されない

#### 技術的考慮事項
- モニター画面はServer Componentで実装（セッション不要）
- Realtimeリスナーのクリーンアップを適切に実装
- 複数ウィンドウでの同時アクセスに対応
- 回答機能を完全に無効化（UIから隠すまたはボタン無効化）

#### 実装リファレンス
- ユーザー画面のコンポーネント構成を参照: `app/(user)/events/[eventId]/`
- 既存のRealtime実装を参照: `app/_lib/hooks/useRealtime.ts`

---

### US-004-02: モニター画面のUI/UX調整
**As an** admin
**I want to** モニター画面を会場表示に最適化する
**So that** 見やすく、映えのある表示ができる

#### 受け入れ基準

##### 1. 画面表示の最適化
- [ ] **フォントサイズを拡大**: ユーザー画面より30-50%大きくする
- [ ] **コントラストを強化**: 背景色を濃くし、テキストを見やすくする
- [ ] **ウィンドウサイズ**: フルスクリーンまたは大きなディスプレイを想定したレイアウト
- [ ] **選択肢のサイズ**: 大型モニターでも読みやすいサイズに

##### 2. ランキング表示の改善
- [ ] **period_result画面**: ランキングを大きく表示
- [ ] **final_result画面**: 優勝者を強調表示
- [ ] **フォーカス**: 1位のユーザーを目立たせる（背景色変更など）

##### 3. 回答状況の表示（オプション）
- [ ] 回答状況（回答済み人数/全体人数）をリアルタイムで表示
- [ ] プログレスバーで進捗を可視化

##### 4. エラーハンドリング
- [ ] ネットワークエラー時のリトライ機能
- [ ] 接続切断時の案内表示

#### 技術的考慮事項
- Tailwind CSSで大型ディスプレイ対応のレスポンシブ設計
- フォント読み込み最適化（Google Fonts）
- 画像最適化（会場環境での表示を想定）

---

### US-004-03: ユーザー画面のUI/UX統一
**As an** user
**I want to** ユーザー画面がモニター画面と統一されたUIで表示される
**So that** 統一感のあるクイズ体験ができる

#### 受け入れ基準

##### 1. UIコンポーネントの統一
- [ ] **選択肢のスタイル**: モニター画面と同じデザイン
- [ ] **ランキング表示**: モニター画面と同じレイアウト
- [ ] **テキスト/ボタン**: 統一されたフォントとサイズ
- [ ] **カラースキーム**: 統一された色合い

##### 2. レスポンシブデザイン
- [ ] **スマートフォン**: 読みやすいサイズを保持
- [ ] **タブレット**: 柔軟なレイアウト
- [ ] **デスクトップ**: モニター画面と近いレイアウト

##### 3. 既存機能への影響
- [ ] ユーザー画面の回答機能は変わらない
- [ ] セッション機能は変わらない
- [ ] 得点計算などは変わらない

#### 技術的考慮事項
- 既存のコンポーネント設計を活かす
- DRY原則: 共有コンポーネント化
- UI/UXの統一感を保つ

---

## 実装フロー

### 1. 基本実装（US-004-01）
```
1. `/app/monitor/` ディレクトリ作成
2. `[eventId]/page.tsx` でモニター画面ページ作成
3. Realtimeリスナーで quiz_control 監視
4. ユーザー画面コンポーネントの再利用
5. 管理画面にリンクボタン追加
```

### 2. UI/UX調整（US-004-02）
```
1. フォントサイズ・コントラスト調整
2. レスポンシブ設計改善
3. ランキング表示の最適化
4. エラーハンドリング実装
```

### 3. ユーザー画面統一（US-004-03）
```
1. 共有UIコンポーネント抽出
2. ユーザー画面に適用
3. レスポンシブ対応
4. 既存機能の互換性確認
```

---

## ディレクトリ構造

実装後の想定構造:

```
app/
├── (user)/              # ユーザー画面
│   └── events/[eventId]/
│       ├── page.tsx     # ユーザー画面（修正対象: US-004-03）
│       └── ...
├── monitor/             # モニター画面（新規: US-004-01, 02）
│   ├── [eventId]/
│   │   ├── page.tsx
│   │   ├── _components/
│   │   │   ├── MonitorWaiting.tsx
│   │   │   ├── MonitorQuestion.tsx
│   │   │   ├── MonitorAnswer.tsx
│   │   │   ├── MonitorBreak.tsx
│   │   │   ├── MonitorPeriodResult.tsx
│   │   │   ├── MonitorFinalResult.tsx
│   │   │   └── MonitorLayout.tsx
│   │   └── hooks/
│   │       └── useMonitorSync.ts
│   └── layout.tsx
└── (admin)/             # 管理画面（UI修正: リンク追加）
    └── admin/control/
        └── _components/
            └── ControlPanel.tsx
```

---

## 注記

- **段階的実装**: 各ユーザーストーリーは独立してマージ可能
- **既存コードへの影響**: US-004-03で既存ユーザー画面を修正するが、機能には影響しない
- **テスト**: 各画面でRealtime同期が正常に動作することを確認
- **将来的な改善**: 音声通知、エフェクト表示など

---

最終更新: 2025年11月26日
